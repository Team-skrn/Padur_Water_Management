<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Configuration Manager</title>
    <script src="config.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }

        h2 {
            color: #667eea;
            margin-top: 30px;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .section {
            margin-bottom: 40px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 15px 0;
        }

        button {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        button:hover {
            background: #764ba2;
        }

        button.secondary {
            background: #17a2b8;
        }

        button.secondary:hover {
            background: #138496;
        }

        input[type="file"] {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }

        .message {
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            display: none;
        }

        .message.success {
            display: block;
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            display: block;
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .message.info {
            display: block;
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        table th, table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        table th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        table tr:hover {
            background: #f5f5f5;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: 600;
            background: #28a745;
            color: white;
        }
    </style>
</head>
<body>
    <div id="loginContainer" style="display: flex; justify-content: center; align-items: center; min-height: 100vh;">
        <div style="background: white; padding: 40px; border-radius: 10px; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); text-align: center; max-width: 400px;">
            <h1 style="color: #667eea; margin-bottom: 30px;">Admin Login</h1>
            <div style="margin-bottom: 20px;">
                <input type="password" id="passwordInput" placeholder="Enter Admin Password" style="width: 100%; padding: 12px; border: 2px solid #667eea; border-radius: 5px; font-size: 16px;">
            </div>
            <button onclick="checkPassword()" style="width: 100%; padding: 12px; background: #667eea; color: white; border: none; border-radius: 5px; font-size: 16px; font-weight: bold; cursor: pointer;">Login</button>
            <p id="errorMsg" style="color: red; margin-top: 15px; display: none;">Incorrect password!</p>
        </div>
    </div>

    <div id="adminContent" style="display: none;">
    <div class="container">
        <h1>üîß Water Management System - Admin Panel</h1>
        
        <div id="message" class="message"></div>

        <!-- CSV Management Section -->
        <div class="section">
            <h2>üìä CSV Configuration Management</h2>
            <p style="margin-bottom: 15px; color: #666;">Download a sample CSV template, edit it with your page and translation data, then upload to generate config.js and translation files.</p>
            
            <div class="button-group">
                <button class="secondary" onclick="generateAndDownloadSampleCSV()">üì• Download Sample CSV</button>
                <button class="secondary" onclick="document.getElementById('csvFile').click()">üì§ Upload & Generate Config</button>
                <input type="file" id="csvFile" accept=".csv" style="display: none;" onchange="handleCSVUpload(event)">
            </div>
        </div>

        <!-- Current Configuration Status -->
        <div class="section">
            <h2>‚úÖ Current Configuration Status</h2>
            <table>
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>Status</th>
                        <th>Details</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Pages Configured</td>
                        <td><span class="badge" id="pageCount">0</span></td>
                        <td id="pageDetails">Loading...</td>
                    </tr>
                    <tr>
                        <td>Translation Languages</td>
                        <td><span class="badge">10</span></td>
                        <td>EN, ES, FR, AR, GU, HI, MR, TA, TE, SW</td>
                    </tr>
                    <tr>
                        <td>Base Translation Keys</td>
                        <td><span class="badge">41</span></td>
                        <td>UI text, labels, buttons</td>
                    </tr>
                    <tr>
                        <td>Page Translation Keys</td>
                        <td><span class="badge" id="pageKeyCount">0</span></td>
                        <td>Dynamic page names (page_*)</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Download Generated Files -->
        <div class="section">
            <h2>üíæ Download Generated Files</h2>
            <p style="margin-bottom: 15px; color: #666;">After uploading a CSV, download the generated files to deploy.</p>
            
            <div class="button-group">
                <button onclick="downloadConfigJS()">üìÑ config.js</button>
                <button class="secondary" onclick="downloadAllTranslations()">üåç All Translation Files</button>
            </div>
        </div>

        <!-- Instructions -->
        <div class="section" style="background: #e7f3ff; border-left-color: #17a2b8;">
            <h2 style="border-bottom-color: #17a2b8; color: #17a2b8;">üìñ How to Use</h2>
            <ol style="margin-left: 20px; color: #333; line-height: 1.8;">
                <li><strong>Download Sample CSV</strong> - Get a template with required columns</li>
                <li><strong>Edit in Excel or Google Sheets</strong> - Add your pages, sensors, and translations</li>
                <li><strong>Upload the CSV</strong> - System will generate config.js and all translation files</li>
                <li><strong>Download Generated Files</strong> - Save config.js and translation JSON files</li>
                <li><strong>Deploy to Server</strong> - Replace old files with the new ones</li>
                <li><strong>Refresh the App</strong> - Changes load automatically</li>
            </ol>
        </div>
    </div>

    <script>
        const languages = ['en', 'es', 'fr', 'ar', 'gu', 'hi', 'mr', 'ta', 'te', 'sw'];
        
        const baseTranslations = {
            'en': {"app_title":"IIT Madras Water Management","select_tank_sump":"Select the Tank/Sump","install_app":"Install App","back":"Back","water_level_monitoring":"IIT Madras Water Management","water_management":"","language_label":"Language:","language_select":"Select Language","reservoir":"Reservoir","overhead_tank":"Overhead Tank","history":"History","custom_range":"Custom Range","from":"From:","to":"To:","fetch_data":"Fetch Data","reservoir_history":"Reservoir Water Level History","overhead_tank_history":"Overhead Tank Water Level History","day_1":"1 Day","day_2":"2 Days","day_3":"3 Days","day_4":"4 Days","day_5":"5 Days","day_6":"6 Days","day_7":"7 Days","waiting_for_updates":"Waiting for updates...","waiting_for_history":"Waiting for history data...","line_color":"Graph Line Color","water_level_history":"Water Level History","enable_alerts":"Enable Alerts","repeat_alerts":"Repeat Alerts (every 5 min)","min_threshold":"Min","max_threshold":"Max"},
            'hi': {"app_title":"IIT ‡§Æ‡§¶‡•ç‡§∞‡§æ‡§∏ ‡§ú‡§≤ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®","select_tank_sump":"‡§ü‡•à‡§Ç‡§ï/‡§∏‡§Æ‡•ç‡§™ ‡§ö‡•Å‡§®‡•á‡§Ç","install_app":"‡§ê‡§™ ‡§á‡§Ç‡§∏‡•ç‡§ü‡•â‡§≤ ‡§ï‡§∞‡•á‡§Ç","back":"‡§µ‡§æ‡§™‡§∏","water_level_monitoring":"IIT Madras ‡§ú‡§≤ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®","water_management":"","language_label":"‡§≠‡§æ‡§∑‡§æ:","language_select":"‡§≠‡§æ‡§∑‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç","reservoir":"‡§ú‡§≤‡§æ‡§∂‡§Ø","overhead_tank":"‡§ì‡§µ‡§∞‡§π‡•á‡§° ‡§ü‡•à‡§Ç‡§ï","history":"‡§á‡§§‡§ø‡§π‡§æ‡§∏","custom_range":"‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§∞‡•á‡§Ç‡§ú","from":"‡§∏‡•á:","to":"‡§§‡§ï:","fetch_data":"‡§°‡•á‡§ü‡§æ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç","reservoir_history":"‡§ú‡§≤‡§æ‡§∂‡§Ø ‡§ú‡§≤ ‡§∏‡•ç‡§§‡§∞ ‡§ï‡§æ ‡§á‡§§‡§ø‡§π‡§æ‡§∏","overhead_tank_history":"‡§ì‡§µ‡§∞‡§π‡•á‡§° ‡§ü‡•à‡§Ç‡§ï ‡§ú‡§≤ ‡§∏‡•ç‡§§‡§∞ ‡§ï‡§æ ‡§á‡§§‡§ø‡§π‡§æ‡§∏","day_1":"1 ‡§¶‡§ø‡§®","day_2":"2 ‡§¶‡§ø‡§®","day_3":"3 ‡§¶‡§ø‡§®","day_4":"4 ‡§¶‡§ø‡§®","day_5":"5 ‡§¶‡§ø‡§®","day_6":"6 ‡§¶‡§ø‡§®","day_7":"7 ‡§¶‡§ø‡§®","waiting_for_updates":"‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ...","waiting_for_history":"‡§á‡§§‡§ø‡§π‡§æ‡§∏ ‡§°‡•á‡§ü‡§æ ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ...","line_color":"‡§ó‡•ç‡§∞‡§æ‡§´ ‡§≤‡§æ‡§á‡§® ‡§∞‡§Ç‡§ó","water_level_history":"‡§ú‡§≤ ‡§∏‡•ç‡§§‡§∞ ‡§ï‡§æ ‡§á‡§§‡§ø‡§π‡§æ‡§∏","enable_alerts":"‡§Ö‡§≤‡§∞‡•ç‡§ü ‡§∏‡§ï‡•ç‡§∑‡§Æ ‡§ï‡§∞‡•á‡§Ç","repeat_alerts":"‡§Ö‡§≤‡§∞‡•ç‡§ü ‡§¶‡•ã‡§π‡§∞‡§æ‡§è‡§Ç (‡§π‡§∞ 5 ‡§Æ‡§ø‡§®‡§ü)","min_threshold":"‡§®‡•ç‡§Ø‡•Ç‡§®‡§§‡§Æ","max_threshold":"‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ"},
            'es': {"app_title":"Gesti√≥n del Agua IIT Madras","select_tank_sump":"Seleccionar Tanque/Sumidero","install_app":"Instalar Aplicaci√≥n","back":"Atr√°s","water_level_monitoring":"Gesti√≥n del Agua IIT Madras","water_management":"","language_label":"Idioma:","language_select":"Seleccionar Idioma","reservoir":"Dep√≥sito","overhead_tank":"Tanque Elevado","history":"Historial","custom_range":"Rango Personalizado","from":"De:","to":"Hasta:","fetch_data":"Obtener Datos","reservoir_history":"Historial del Nivel de Agua del Dep√≥sito","overhead_tank_history":"Historial del Nivel de Agua del Tanque Elevado","day_1":"1 D√≠a","day_2":"2 D√≠as","day_3":"3 D√≠as","day_4":"4 D√≠as","day_5":"5 D√≠as","day_6":"6 D√≠as","day_7":"7 D√≠as","waiting_for_updates":"Esperando actualizaciones...","waiting_for_history":"Esperando datos hist√≥ricos...","line_color":"Color de L√≠nea del Gr√°fico","water_level_history":"Historial del Nivel de Agua","enable_alerts":"Habilitar Alertas","repeat_alerts":"Repetir Alertas (cada 5 min)","min_threshold":"M√≠n","max_threshold":"M√°x"},
            'fr': {"app_title":"Gestion de l'Eau IIT Madras","select_tank_sump":"S√©lectionner le R√©servoir/Puisard","install_app":"Installer l'Application","back":"Retour","water_level_monitoring":"Gestion de l'Eau IIT Madras","water_management":"","language_label":"Langue:","language_select":"S√©lectionner la Langue","reservoir":"R√©servoir","overhead_tank":"R√©servoir Sur√©lev√©","history":"Historique","custom_range":"Plage Personnalis√©e","from":"De:","to":"√Ä:","fetch_data":"R√©cup√©rer les Donn√©es","reservoir_history":"Historique du Niveau d'Eau du R√©servoir","overhead_tank_history":"Historique du Niveau d'Eau du R√©servoir Sur√©lev√©","day_1":"1 Jour","day_2":"2 Jours","day_3":"3 Jours","day_4":"4 Jours","day_5":"5 Jours","day_6":"6 Jours","day_7":"7 Jours","waiting_for_updates":"En attente de mises √† jour...","waiting_for_history":"En attente des donn√©es historiques...","line_color":"Couleur de la Ligne du Graphique","water_level_history":"Historique du Niveau d'Eau","enable_alerts":"Activer les Alertes","repeat_alerts":"R√©p√©ter les Alertes (toutes les 5 min)","min_threshold":"Min","max_threshold":"Max"},
            'ar': {"app_title":"ÿ•ÿØÿßÿ±ÿ© ŸÖŸäÿßŸá IIT ŸÖÿØÿ±ÿßÿ≥","select_tank_sump":"ÿßÿÆÿ™ÿ± ÿÆÿ≤ÿßŸÜ/ÿ®ÿ¶ÿ±","install_app":"ÿ™ÿ´ÿ®Ÿäÿ™ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ","back":"ÿ±ÿ¨Ÿàÿπ","water_level_monitoring":"ÿ•ÿØÿßÿ±ÿ© ŸÖŸäÿßŸá IIT ŸÖÿØÿ±ÿßÿ≥","water_management":"","language_label":"ÿßŸÑŸÑÿ∫ÿ©:","language_select":"ÿßÿÆÿ™ÿ± ÿßŸÑŸÑÿ∫ÿ©","reservoir":"ÿßŸÑÿÆÿ≤ÿßŸÜ","overhead_tank":"ÿßŸÑÿÆÿ≤ÿßŸÜ ÿßŸÑÿπŸÑŸàŸä","history":"ÿßŸÑÿ≥ÿ¨ŸÑ","custom_range":"ŸÜÿ∑ÿßŸÇ ŸÖÿÆÿµÿµ","from":"ŸÖŸÜ:","to":"ÿ•ŸÑŸâ:","fetch_data":"ÿ¨ŸÑÿ® ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™","reservoir_history":"ÿ≥ÿ¨ŸÑ ŸÖÿ≥ÿ™ŸàŸâ ŸÖŸäÿßŸá ÿßŸÑÿÆÿ≤ÿßŸÜ","overhead_tank_history":"ÿ≥ÿ¨ŸÑ ŸÖÿ≥ÿ™ŸàŸâ ŸÖŸäÿßŸá ÿßŸÑÿÆÿ≤ÿßŸÜ ÿßŸÑÿπŸÑŸàŸä","day_1":"1 ŸäŸàŸÖ","day_2":"2 ÿ£ŸäÿßŸÖ","day_3":"3 ÿ£ŸäÿßŸÖ","day_4":"4 ÿ£ŸäÿßŸÖ","day_5":"5 ÿ£ŸäÿßŸÖ","day_6":"6 ÿ£ŸäÿßŸÖ","day_7":"7 ÿ£ŸäÿßŸÖ","waiting_for_updates":"ŸÅŸä ÿßŸÜÿ™ÿ∏ÿßÿ± ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ÿßÿ™...","waiting_for_history":"ŸÅŸä ÿßŸÜÿ™ÿ∏ÿßÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ™ÿßÿ±ŸäÿÆŸäÿ©...","line_color":"ŸÑŸàŸÜ ÿÆÿ∑ ÿßŸÑÿ±ÿ≥ŸÖ ÿßŸÑÿ®ŸäÿßŸÜŸä","water_level_history":"ÿ≥ÿ¨ŸÑ ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑŸÖŸäÿßŸá","enable_alerts":"ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ™ŸÜÿ®ŸäŸáÿßÿ™","repeat_alerts":"ÿ™ŸÉÿ±ÿßÿ± ÿßŸÑÿ™ŸÜÿ®ŸäŸáÿßÿ™ (ŸÉŸÑ 5 ÿØŸÇÿßÿ¶ŸÇ)","min_threshold":"ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ÿØŸÜŸâ","max_threshold":"ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ"},
            'gu': {"app_title":"IIT ‡™Æ‡™¶‡´ç‡™∞‡™æ‡™∏ ‡™ú‡™≤ ‡™µ‡´ç‡™Ø‡™µ‡™∏‡´ç‡™•‡™æ‡™™‡™®","select_tank_sump":"‡™ü‡™æ‡™Ç‡™ï‡´Ä/‡™∏‡™Æ‡´ç‡™™ ‡™™‡™∏‡™Ç‡™¶ ‡™ï‡™∞‡´ã","install_app":"‡™ç‡™™ ‡™á‡™®‡´ç‡™∏‡´ç‡™ü‡´ã‡™≤ ‡™ï‡™∞‡´ã","back":"‡™™‡™æ‡™õ‡™≥","water_level_monitoring":"IIT Madras ‡™ú‡™≤ ‡™µ‡´ç‡™Ø‡™µ‡™∏‡´ç‡™•‡™æ‡™™‡™®","water_management":"","language_label":"‡™≠‡™æ‡™∑‡™æ:","language_select":"‡™≠‡™æ‡™∑‡™æ ‡™™‡™∏‡™Ç‡™¶ ‡™ï‡™∞‡´ã","reservoir":"‡™ú‡™≥‡™æ‡™∂‡™Ø","overhead_tank":"‡™ì‡™µ‡™∞‡™π‡´á‡™° ‡™ü‡™æ‡™Ç‡™ï‡´Ä","history":"‡™á‡™§‡™ø‡™π‡™æ‡™∏","custom_range":"‡™ï‡™∏‡´ç‡™ü‡™Æ ‡™∂‡´ç‡™∞‡´á‡™£‡´Ä","from":"‡™•‡´Ä:","to":"‡™∏‡´Å‡™ß‡´Ä:","fetch_data":"‡™°‡´á‡™ü‡™æ ‡™Æ‡´á‡™≥‡™µ‡´ã","reservoir_history":"‡™ú‡™≥‡™æ‡™∂‡™Ø ‡™ú‡™≤ ‡™∏‡´ç‡™§‡™∞ ‡™á‡™§‡™ø‡™π‡™æ‡™∏","overhead_tank_history":"‡™ì‡™µ‡™∞‡™π‡´á‡™° ‡™ü‡™æ‡™Ç‡™ï‡´Ä ‡™ú‡™≤ ‡™∏‡´ç‡™§‡™∞ ‡™á‡™§‡™ø‡™π‡™æ‡™∏","day_1":"1 ‡™¶‡™ø‡™µ‡™∏","day_2":"2 ‡™¶‡™ø‡™µ‡™∏","day_3":"3 ‡™¶‡™ø‡™µ‡™∏","day_4":"4 ‡™¶‡™ø‡™µ‡™∏","day_5":"5 ‡™¶‡™ø‡™µ‡™∏","day_6":"6 ‡™¶‡™ø‡™µ‡™∏","day_7":"7 ‡™¶‡™ø‡™µ‡™∏","waiting_for_updates":"‡™Ö‡™™‡™°‡´á‡™ü‡´ç‡™∏‡™®‡´Ä ‡™∞‡™æ‡™π ‡™ú‡´ã‡™à ‡™∞‡™π‡´ç‡™Ø‡™æ‡™Ç ‡™õ‡´Ä‡™è...","waiting_for_history":"‡™á‡™§‡™ø‡™π‡™æ‡™∏ ‡™°‡´á‡™ü‡™æ‡™®‡´Ä ‡™∞‡™æ‡™π ‡™ú‡´ã‡™à ‡™∞‡™π‡´ç‡™Ø‡™æ‡™Ç ‡™õ‡´Ä‡™è...","line_color":"‡™Ü‡™≤‡´á‡™ñ ‡™≤‡™æ‡™á‡™®‡™®‡´ã ‡™∞‡™Ç‡™ó","water_level_history":"‡™ú‡™≥ ‡™∏‡´ç‡™§‡™∞ ‡™á‡™§‡™ø‡™π‡™æ‡™∏","enable_alerts":"‡™∏‡™§‡™∞‡´ç‡™ï‡™§‡™æ ‡™∏‡™ï‡´ç‡™∑‡™Æ ‡™ï‡™∞‡´ã","repeat_alerts":"‡™∏‡™§‡™∞‡´ç‡™ï‡™§‡™æ‡™®‡´á ‡™™‡´Å‡™®‡™∞‡™æ‡™µ‡™∞‡´ç‡™§‡™ø‡™§ ‡™ï‡™∞‡´ã (‡™¶‡™∞ 5 ‡™Æ‡™ø‡™®‡™ø‡™ü‡´á)","min_threshold":"‡™®‡´ç‡™Ø‡´Ç‡™®‡™§‡™Æ","max_threshold":"‡™Æ‡™π‡™§‡´ç‡™§‡™Æ"},
            'mr': {"app_title":"IIT ‡§Æ‡§¶‡•ç‡§∞‡§æ‡§∏ ‡§ú‡§≤ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§®","select_tank_sump":"‡§ü‡§æ‡§ï‡•Ä/‡§∏‡§Æ‡•ç‡§™ ‡§®‡§ø‡§µ‡§°‡§æ","install_app":"‡§Ö‡•Ö‡§™ ‡§á‡§Ç‡§∏‡•ç‡§ü‡•â‡§≤ ‡§ï‡§∞‡§æ","back":"‡§™‡§∞‡§§","water_level_monitoring":"IIT Madras ‡§ú‡§≤ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§®","water_management":"","language_label":"‡§≠‡§æ‡§∑‡§æ:","language_select":"‡§≠‡§æ‡§∑‡§æ ‡§®‡§ø‡§µ‡§°‡§æ","reservoir":"‡§ú‡§≤‡§æ‡§∂‡§Ø","overhead_tank":"‡§ì‡§µ‡•ç‡§π‡§∞‡§π‡•á‡§° ‡§ü‡§æ‡§ï‡•Ä","history":"‡§á‡§§‡§ø‡§π‡§æ‡§∏","custom_range":"‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§∂‡•ç‡§∞‡•á‡§£‡•Ä","from":"‡§™‡§æ‡§∏‡•Ç‡§®:","to":"‡§™‡§∞‡•ç‡§Ø‡§Ç‡§§:","fetch_data":"‡§°‡•á‡§ü‡§æ ‡§Æ‡§ø‡§≥‡§µ‡§æ","reservoir_history":"‡§ú‡§≤‡§æ‡§∂‡§Ø ‡§ú‡§≤ ‡§∏‡•ç‡§§‡§∞ ‡§á‡§§‡§ø‡§π‡§æ‡§∏","overhead_tank_history":"‡§ì‡§µ‡•ç‡§π‡§∞‡§π‡•á‡§° ‡§ü‡§æ‡§ï‡•Ä ‡§ú‡§≤ ‡§∏‡•ç‡§§‡§∞ ‡§á‡§§‡§ø‡§π‡§æ‡§∏","day_1":"1 ‡§¶‡§ø‡§µ‡§∏","day_2":"2 ‡§¶‡§ø‡§µ‡§∏","day_3":"3 ‡§¶‡§ø‡§µ‡§∏","day_4":"4 ‡§¶‡§ø‡§µ‡§∏","day_5":"5 ‡§¶‡§ø‡§µ‡§∏","day_6":"6 ‡§¶‡§ø‡§µ‡§∏","day_7":"7 ‡§¶‡§ø‡§µ‡§∏","waiting_for_updates":"‡§Ö‡§™‡§°‡•á‡§ü‡•ç‡§∏‡§ö‡•Ä ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ...","waiting_for_history":"‡§á‡§§‡§ø‡§π‡§æ‡§∏ ‡§°‡•á‡§ü‡§æ‡§ö‡•Ä ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ...","line_color":"‡§Ü‡§≤‡•á‡§ñ ‡§∞‡•á‡§∑‡§æ ‡§∞‡§Ç‡§ó","water_level_history":"‡§ú‡§≤ ‡§∏‡•ç‡§§‡§∞ ‡§á‡§§‡§ø‡§π‡§æ‡§∏","enable_alerts":"‡§∏‡§§‡§∞‡•ç‡§ï‡§§‡§æ ‡§∏‡§ï‡•ç‡§∑‡§Æ ‡§ï‡§∞‡§æ","repeat_alerts":"‡§∏‡§§‡§∞‡•ç‡§ï‡§§‡§æ ‡§™‡•Å‡§®‡§∞‡§æ‡§µ‡•É‡§§‡•ç‡§§‡•Ä ‡§ï‡§∞‡§æ (‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï 5 ‡§Æ‡§ø‡§®‡§ø‡§ü‡§æ‡§≤‡§æ)","min_threshold":"‡§ï‡§ø‡§Æ‡§æ‡§®","max_threshold":"‡§ï‡§Æ‡§æ‡§≤"},
            'ta': {"app_title":"‡Æê‡Æê‡Æü‡Æø ‡ÆÆ‡ØÜ‡Æü‡Øç‡Æ∞‡Ææ‡Æ∏‡Øç ‡Æ®‡ØÄ‡Æ∞‡Øç ‡ÆÆ‡Øá‡Æ≤‡Ææ‡Æ£‡Øç‡ÆÆ‡Øà","select_tank_sump":"‡Æ§‡Øä‡Æü‡Øç‡Æü‡Æø/‡Æö‡ÆÆ‡Øç‡Æ™‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æµ‡ØÅ ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç","install_app":"‡Æ™‡ÆØ‡Æ©‡Øç‡Æ™‡Ææ‡Æü‡Øç‡Æü‡Øà ‡Æ®‡Æø‡Æ±‡ØÅ‡Æµ‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç","back":"‡Æ™‡Æø‡Æ©‡Øç","water_level_monitoring":"‡Æê‡Æê‡Æü‡Æø ‡ÆÆ‡ØÜ‡Æü‡Øç‡Æ∞‡Ææ‡Æ∏‡Øç ‡Æ®‡ØÄ‡Æ∞‡Øç ‡ÆÆ‡Øá‡Æ≤‡Ææ‡Æ£‡Øç‡ÆÆ‡Øà","water_management":"","language_label":"‡ÆÆ‡Øä‡Æ¥‡Æø:","language_select":"‡ÆÆ‡Øä‡Æ¥‡Æø‡ÆØ‡Øà‡Æ§‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æµ‡ØÅ ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç","reservoir":"‡Æ®‡ØÄ‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Øá‡Æï‡Øç‡Æï‡ÆÆ‡Øç","overhead_tank":"‡ÆÆ‡Øá‡Æ≤‡Øç ‡Æ§‡Øä‡Æü‡Øç‡Æü‡Æø","history":"‡Æµ‡Æ∞‡Æ≤‡Ææ‡Æ±‡ØÅ","custom_range":"‡Æµ‡Æø‡Æ∞‡ØÅ‡Æ™‡Øç‡Æ™ ‡Æµ‡Æ∞‡ÆÆ‡Øç‡Æ™‡ØÅ","from":"‡ÆÆ‡ØÅ‡Æ§‡Æ≤‡Øç:","to":"‡Æµ‡Æ∞‡Øà:","fetch_data":"‡Æ§‡Æ∞‡Æµ‡ØÅ ‡Æ™‡ØÜ‡Æ±‡ØÅ‡Æï","reservoir_history":"‡Æ®‡ØÄ‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Øá‡Æï‡Øç‡Æï ‡Æ®‡ØÄ‡Æ∞‡Øç ‡ÆÆ‡Æü‡Øç‡Æü ‡Æµ‡Æ∞‡Æ≤‡Ææ‡Æ±‡ØÅ","overhead_tank_history":"‡ÆÆ‡Øá‡Æ≤‡Øç ‡Æ§‡Øä‡Æü‡Øç‡Æü‡Æø ‡Æ®‡ØÄ‡Æ∞‡Øç ‡ÆÆ‡Æü‡Øç‡Æü ‡Æµ‡Æ∞‡Æ≤‡Ææ‡Æ±‡ØÅ","day_1":"1 ‡Æ®‡Ææ‡Æ≥‡Øç","day_2":"2 ‡Æ®‡Ææ‡Æü‡Øç‡Æï‡Æ≥‡Øç","day_3":"3 ‡Æ®‡Ææ‡Æü‡Øç‡Æï‡Æ≥‡Øç","day_4":"4 ‡Æ®‡Ææ‡Æü‡Øç‡Æï‡Æ≥‡Øç","day_5":"5 ‡Æ®‡Ææ‡Æü‡Øç‡Æï‡Æ≥‡Øç","day_6":"6 ‡Æ®‡Ææ‡Æü‡Øç‡Æï‡Æ≥‡Øç","day_7":"7 ‡Æ®‡Ææ‡Æü‡Øç‡Æï‡Æ≥‡Øç","waiting_for_updates":"‡Æ™‡ØÅ‡Æ§‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡Ææ‡Æï ‡Æï‡Ææ‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Æø‡Æ±‡Æ§‡ØÅ...","waiting_for_history":"‡Æµ‡Æ∞‡Æ≤‡Ææ‡Æ±‡Øç‡Æ±‡ØÅ ‡Æ§‡Æ∞‡Æµ‡ØÅ‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡Ææ‡Æï ‡Æï‡Ææ‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Æø‡Æ±‡Æ§‡ØÅ...","line_color":"‡Æµ‡Æ∞‡Øà‡Æ™‡Æü ‡Æï‡Øã‡Æü‡Øç‡Æü‡Æø‡Æ©‡Øç ‡Æ®‡Æø‡Æ±‡ÆÆ‡Øç","water_level_history":"‡Æ®‡ØÄ‡Æ∞‡Øç ‡ÆÆ‡Æü‡Øç‡Æü ‡Æµ‡Æ∞‡Æ≤‡Ææ‡Æ±‡ØÅ","enable_alerts":"‡Æé‡Æö‡Øç‡Æö‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Øà‡Æï‡Æ≥‡Øà ‡Æá‡ÆØ‡Æï‡Øç‡Æï‡ØÅ","repeat_alerts":"‡Æé‡Æö‡Øç‡Æö‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Øà‡Æï‡Æ≥‡Øà ‡ÆÆ‡ØÄ‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç (‡Æí‡Æµ‡Øç‡Æµ‡Øä‡Æ∞‡ØÅ 5 ‡Æ®‡Æø‡ÆÆ‡Æø‡Æü‡Æ§‡Øç‡Æ§‡Æø‡Æ±‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç)","min_threshold":"‡Æï‡ØÅ‡Æ±‡Øà‡Æ®‡Øç‡Æ§‡Æ™‡Æü‡Øç‡Æö‡ÆÆ‡Øç","max_threshold":"‡ÆÖ‡Æ§‡Æø‡Æï‡Æ™‡Æü‡Øç‡Æö‡ÆÆ‡Øç"},
            'te': {"app_title":"‡∞ê ‡∞ê ‡∞ü‡∞ø ‡∞Æ‡∞¶‡±ç‡∞∞‡∞æ‡∞∏‡±Å ‡∞®‡±Ä‡∞ü‡∞ø ‡∞®‡∞ø‡∞∞‡±ç‡∞µ‡∞π‡∞£","select_tank_sump":"‡∞ü‡±ç‡∞Ø‡∞æ‡∞Ç‡∞ï‡±ç/‡∞∏‡∞Ç‡∞™‡±Å ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø","install_app":"‡∞Ø‡∞æ‡∞™‡±ç‚Äå‡∞®‡±Å ‡∞á‡∞®‡±ç‚Äå‡∞∏‡±ç‡∞ü‡∞æ‡∞≤‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø","back":"‡∞µ‡±Ü‡∞®‡±Å‡∞ï‡∞ï‡±Å","water_level_monitoring":"‡∞ê ‡∞ê ‡∞ü‡∞ø ‡∞Æ‡∞¶‡±ç‡∞∞‡∞æ‡∞∏‡±Å ‡∞®‡±Ä‡∞ü‡∞ø ‡∞®‡∞ø‡∞∞‡±ç‡∞µ‡∞π‡∞£","water_management":"","language_label":"‡∞≠‡∞æ‡∞∑:","language_select":"‡∞≠‡∞æ‡∞∑‡∞®‡±Å ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø","reservoir":"‡∞ú‡∞≤‡∞æ‡∞∂‡∞Ø‡∞Ç","overhead_tank":"‡∞ì‡∞µ‡∞∞‡±ç‚Äå‡∞π‡±Ü‡∞°‡±ç ‡∞ü‡±ç‡∞Ø‡∞æ‡∞Ç‡∞ï‡±ç","history":"‡∞ö‡∞∞‡∞ø‡∞§‡±ç‡∞∞","custom_range":"‡∞ï‡∞∏‡±ç‡∞ü‡∞Æ‡±ç ‡∞™‡∞∞‡∞ø‡∞ß‡∞ø","from":"‡∞®‡±Å‡∞Ç‡∞°‡∞ø:","to":"‡∞µ‡∞∞‡∞ï‡±Å:","fetch_data":"‡∞°‡±á‡∞ü‡∞æ ‡∞™‡±ä‡∞Ç‡∞¶‡∞Ç‡∞°‡∞ø","reservoir_history":"‡∞ú‡∞≤‡∞æ‡∞∂‡∞Ø ‡∞®‡±Ä‡∞ü‡∞ø ‡∞∏‡±ç‡∞•‡∞æ‡∞Ø‡∞ø ‡∞ö‡∞∞‡∞ø‡∞§‡±ç‡∞∞","overhead_tank_history":"‡∞ì‡∞µ‡∞∞‡±ç‚Äå‡∞π‡±Ü‡∞°‡±ç ‡∞ü‡±ç‡∞Ø‡∞æ‡∞Ç‡∞ï‡±ç ‡∞®‡±Ä‡∞ü‡∞ø ‡∞∏‡±ç‡∞•‡∞æ‡∞Ø‡∞ø ‡∞ö‡∞∞‡∞ø‡∞§‡±ç‡∞∞","day_1":"1 ‡∞∞‡±ã‡∞ú‡±Å","day_2":"2 ‡∞∞‡±ã‡∞ú‡±Å‡∞≤‡±Å","day_3":"3 ‡∞∞‡±ã‡∞ú‡±Å‡∞≤‡±Å","day_4":"4 ‡∞∞‡±ã‡∞ú‡±Å‡∞≤‡±Å","day_5":"5 ‡∞∞‡±ã‡∞ú‡±Å‡∞≤‡±Å","day_6":"6 ‡∞∞‡±ã‡∞ú‡±Å‡∞≤‡±Å","day_7":"7 ‡∞∞‡±ã‡∞ú‡±Å‡∞≤‡±Å","waiting_for_updates":"‡∞®‡∞µ‡±Ä‡∞ï‡∞∞‡∞£‡∞≤ ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞é‡∞¶‡±Å‡∞∞‡±Å‡∞ö‡±Ç‡∞∏‡±ç‡∞§‡±ã‡∞Ç‡∞¶‡∞ø...","waiting_for_history":"‡∞ö‡∞∞‡∞ø‡∞§‡±ç‡∞∞ ‡∞°‡±á‡∞ü‡∞æ ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞é‡∞¶‡±Å‡∞∞‡±Å‡∞ö‡±Ç‡∞∏‡±ç‡∞§‡±ã‡∞Ç‡∞¶‡∞ø...","line_color":"‡∞ó‡±ç‡∞∞‡∞æ‡∞´‡±ç ‡∞≤‡±à‡∞®‡±ç ‡∞∞‡∞Ç‡∞ó‡±Å","water_level_history":"‡∞®‡±Ä‡∞ü‡∞ø ‡∞∏‡±ç‡∞•‡∞æ‡∞Ø‡∞ø ‡∞ö‡∞∞‡∞ø‡∞§‡±ç‡∞∞","enable_alerts":"‡∞Ö‡∞≤‡∞∞‡±ç‡∞ü‡±ç‚Äå‡∞≤‡∞®‡±Å ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø","repeat_alerts":"‡∞Ö‡∞≤‡∞∞‡±ç‡∞ü‡±ç‚Äå‡∞≤‡∞®‡±Å ‡∞™‡±Å‡∞®‡∞∞‡∞æ‡∞µ‡±É‡∞§‡±ç‡∞§‡∞ø ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø (‡∞™‡±ç‡∞∞‡∞§‡∞ø 5 ‡∞®‡∞ø‡∞Æ‡∞ø‡∞∑‡∞æ‡∞≤‡∞ï‡±Å)","min_threshold":"‡∞ï‡∞®‡∞ø‡∞∑‡±ç‡∞ü‡∞Ç","max_threshold":"‡∞ó‡∞∞‡∞ø‡∞∑‡±ç‡∞ü‡∞Ç"},
            'sw': {"app_title":"Usimamizi wa Maji wa IIT Madras","select_tank_sump":"Chagua Tanki/Tangi","install_app":"Sakinisha Programu","back":"Rudi","water_level_monitoring":"Usimamizi wa Maji wa IIT Madras","water_management":"","language_label":"Lugha:","language_select":"Chagua Lugha","reservoir":"Hifadhi","overhead_tank":"Tanki la Juu","history":"Historia","custom_range":"Anuwai ya Kawaida","from":"Kutoka:","to":"Hadi:","fetch_data":"Chukua Data","reservoir_history":"Historia ya Kiwango cha Maji ya Hifadhi","overhead_tank_history":"Historia ya Kiwango cha Maji ya Tanki la Juu","day_1":"Siku 1","day_2":"Siku 2","day_3":"Siku 3","day_4":"Siku 4","day_5":"Siku 5","day_6":"Siku 6","day_7":"Siku 7","waiting_for_updates":"Inasubiri sasisho...","waiting_for_history":"Inasubiri data ya historia...","line_color":"Rangi ya Mstari wa Grafu","water_level_history":"Historia ya Kiwango cha Maji","enable_alerts":"Wezesha Onyo","repeat_alerts":"Kurudia Onyo (kila dakika 5)","min_threshold":"Kiwango cha Chini","max_threshold":"Kiwango cha Juu"}
        };

        document.addEventListener('DOMContentLoaded', updateStatusDisplay);

        function updateStatusDisplay() {
            if (typeof appConfig !== 'undefined') {
                const pages = appConfig.getAllPages();
                document.getElementById('pageCount').textContent = pages.length;
                document.getElementById('pageDetails').textContent = pages.map(p => p.displayName).join(', ');
                document.getElementById('pageKeyCount').textContent = pages.length;
            }
        }

        function generateAndDownloadSampleCSV() {
            if (typeof appConfig === 'undefined') {
                showMessage('‚ùå config.js not loaded', 'error');
                return;
            }

            const pages = appConfig.getAllPages();
            let csv = 'Page ID,Display Name,Title,Sensor ID,Sensor Name,Channel ID,API Key,Field,Warning Limit,Danger Limit';
            languages.forEach(lang => {
                csv += `,PageName_${lang.toUpperCase()}`;
            });
            languages.forEach(lang => {
                csv += `,SensorName_${lang.toUpperCase()}`;
            });
            csv += '\n';

            // Add current pages as examples with their sensors
            pages.forEach(page => {
                const config = appConfig.getPage(page.id);
                const sensors = appConfig.getSensorsForPage(page.id);
                
                sensors.forEach((sensor, idx) => {
                    csv += `${config.id},${config.displayName},"${config.title}",${sensor.displayName || config.id},"${sensor.displayName || config.id}",${sensor.channelID},${sensor.apiKey},${sensor.field},${sensor.limits.warning},${sensor.limits.danger}`;
                    // Page name translations
                    languages.forEach(() => {
                        csv += `,${config.displayName}`;
                    });
                    // Sensor name translations
                    languages.forEach(() => {
                        csv += `,"${sensor.displayName || config.id}"`;
                    });
                    csv += '\n';
                });
            });

            downloadFile(csv, 'sample_config.csv', 'text/csv;charset=utf-8;');
            showMessage('‚úÖ Sample CSV downloaded!', 'success');
        }

        function handleCSVUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const csv = e.target.result;
                    const lines = csv.split('\n').map(line => line.trim()).filter(line => line);
                    
                    if (lines.length < 2) {
                        showMessage('‚ùå CSV file is empty', 'error');
                        return;
                    }

                    const headers = lines[0].split(',').map(h => h.trim());
                    const pageIdIdx = headers.indexOf('Page ID');
                    const displayNameIdx = headers.indexOf('Display Name');
                    const titleIdx = headers.indexOf('Title');
                    const sensorIdIdx = headers.indexOf('Sensor ID');
                    const sensorNameIdx = headers.indexOf('Sensor Name');
                    const channelIdIdx = headers.indexOf('Channel ID');
                    const apiKeyIdx = headers.indexOf('API Key');
                    const fieldIdx = headers.indexOf('Field');
                    const warningIdx = headers.indexOf('Warning Limit');
                    const dangerIdx = headers.indexOf('Danger Limit');

                    if (pageIdIdx === -1 || displayNameIdx === -1) {
                        showMessage('‚ùå CSV headers missing required columns', 'error');
                        return;
                    }

                    const newConfig = { appTitle: 'IITM Water Management', defaultLanguage: 'en', pages: {} };
                    const translations = {};
                    languages.forEach(lang => {
                        translations[lang] = { ...baseTranslations[lang] };
                    });

                    for (let i = 1; i < lines.length; i++) {
                        const parts = lines[i].split(',').map(p => p.trim()).map(p => p.replace(/^"(.*)"$/, '$1'));
                        if (parts[pageIdIdx] === '') continue;

                        const pageId = parts[pageIdIdx];
                        const displayName = parts[displayNameIdx];
                        const title = parts[titleIdx] || displayName;
                        const sensorId = parts[sensorIdIdx] || pageId;
                        const sensorName = parts[sensorNameIdx] || sensorId;

                        // Create page if it doesn't exist
                        if (!newConfig.pages[pageId]) {
                            newConfig.pages[pageId] = {
                                id: pageId,
                                displayName: displayName,
                                title: title,
                                icon: '',
                                sensors: {}
                            };

                            // Add page translations only once per page
                            languages.forEach((lang) => {
                                const langIdx = headers.indexOf(`PageName_${lang.toUpperCase()}`);
                                if (langIdx !== -1 && parts[langIdx]) {
                                    translations[lang][`page_${pageId}`] = parts[langIdx];
                                } else {
                                    translations[lang][`page_${pageId}`] = displayName;
                                }
                            });
                        }

                        // Add sensor to the page
                        newConfig.pages[pageId].sensors[sensorId] = {
                            displayName: sensorName,
                            channelID: parts[channelIdIdx] || '',
                            apiKey: parts[apiKeyIdx] || '',
                            field: parts[fieldIdx] || 'field1',
                            isInteger: true,
                            limits: {
                                warning: parseInt(parts[warningIdx]) || 100,
                                danger: parseInt(parts[dangerIdx]) || 50
                            }
                        };

                        // Add sensor name translations for all languages
                        languages.forEach((lang) => {
                            const sensorNameLangIdx = headers.indexOf(`SensorName_${lang.toUpperCase()}`);
                            const translationKey = `sensor_${pageId}_${sensorId}`;
                            if (sensorNameLangIdx !== -1 && parts[sensorNameLangIdx]) {
                                translations[lang][translationKey] = parts[sensorNameLangIdx];
                            } else {
                                translations[lang][translationKey] = sensorName;
                            }
                        });
                    }

                    window.generatedConfig = newConfig;
                    window.generatedTranslations = translations;

                    showMessage(`‚úÖ CSV processed! ${Object.keys(newConfig.pages).length} pages configured.`, 'success');
                } catch (error) {
                    showMessage(`‚ùå Error: ${error.message}`, 'error');
                }
            };
            reader.readAsText(file);
        }

        function downloadConfigJS() {
            if (!window.generatedConfig) {
                showMessage('‚ùå Upload a CSV first', 'error');
                return;
            }

            const config = window.generatedConfig;
            let code = '/**\n * ‚úÖ DYNAMIC PAGE CONFIGURATION\n */\n\n';
            code += 'const appConfig = ' + JSON.stringify(config, null, 2) + ';\n\n';
            code += '// Helper methods for config\n';
            code += 'appConfig.getAllPages = function() {\n';
            code += '  return Object.values(this.pages).map(page => ({\n';
            code += '    id: page.id,\n';
            code += '    displayName: page.displayName,\n';
            code += "    icon: page.icon || 'üìä'\n";
            code += '  }));\n';
            code += '};\n\n';
            code += 'appConfig.getPage = function(pageId) {\n';
            code += '  return this.pages[pageId];\n';
            code += '};\n\n';
            code += 'appConfig.getSensorsForPage = function(pageId) {\n';
            code += '  const page = this.pages[pageId];\n';
            code += '  return page ? Object.values(page.sensors) : [];\n';
            code += '};\n\n';
            code += 'if (typeof window !== "undefined") {\n    window.appConfig = appConfig;\n}\n';

            downloadFile(code, 'config.js', 'text/javascript;charset=utf-8;');
            showMessage('‚úÖ config.js downloaded!', 'success');
        }

        function downloadAllTranslations() {
            if (!window.generatedTranslations) {
                showMessage('‚ùå Upload a CSV first', 'error');
                return;
            }

            languages.forEach(lang => {
                const json = JSON.stringify(window.generatedTranslations[lang], null, 2);
                downloadFile(json, `${lang}.json`, 'application/json;charset=utf-8;');
            });

            showMessage(`‚úÖ Downloaded ${languages.length} translation files!`, 'success');
        }

        function downloadFile(content, filename, type) {
            const blob = new Blob([content], { type: type });
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(url);
        }

        function showMessage(text, type = 'info') {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = `message ${type}`;
            setTimeout(() => {
                messageEl.className = 'message';
            }, 5000);
        }

        function checkPassword() {
            const password = document.getElementById('passwordInput').value;
            const correctPassword = 'waternet@123'; // Change this to your desired password
            
            if (password === correctPassword) {
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('adminContent').style.display = 'block';
                localStorage.setItem('adminAuthenticated', 'true');
            } else {
                document.getElementById('errorMsg').style.display = 'block';
                document.getElementById('passwordInput').value = '';
                setTimeout(() => {
                    document.getElementById('errorMsg').style.display = 'none';
                }, 3000);
            }
        }

        function checkAuthOnLoad() {
            if (localStorage.getItem('adminAuthenticated') === 'true') {
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('adminContent').style.display = 'block';
            }
        }

        // Allow Enter key to submit password
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthOnLoad();
            document.getElementById('passwordInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkPassword();
                }
            });
        });
    </script>
    </div>
</body>
</html>
